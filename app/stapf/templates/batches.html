{% extends "base.html" %}

{% block title %}Mail-Aufträge{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">
// Adapted from http://jsfiddle.net/ukW2C/3/
$("#search").keyup(function () {
      //split the current value of search
      var data = this.value.split(" ");

      //create a jquery object of the rows
      var jo = $("#batches").find("tr");
      if (this.value == "") {
                jo.show();
                $("#search-group").removeClass("has-error");
                $("#search-group").removeClass("has-success");
                return;
            }
      //hide all the rows
      jo.hide();

      //Recusively filter the jquery object to get results.
      filtered = jo.filter(function (i, v) {
                var $t = $(this);
                for (var d = 0; d < data.length; ++d) {
                              if ($t.is(":contains('" + data[d] + "')")) {
                                                return true;
                                            }
                          }
                return false;
            });
      //show the rows that match.
      filtered.show();

      //update the search bar validation status
      if (filtered.length) {
        $("#search-group").addClass("has-success");
        $("#search-group").removeClass("has-error");
      } else {
        $("#search-group").addClass("has-error");
        $("#search-group").removeClass("has-success");
      }
}).focus(function () {
      this.value = "";
      $(this).unbind('focus');
});
</script>
{% endblock %}

{% block content %}
<div class="container">
  <h1>Mail-Aufträge</h1>

  <div id="search-group" class="form-group has-feedback">
    <label class="control-label sr-only" for="search">Suche für Adressaten</label>
    <div class="input-group">
      <span class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
      <input id="search" type="text" class="form-control input-lg" placeholder="Suche">
    </div>
  </div>

  <div class="btn-group" role="group">
    <a class="btn btn-default" href="{{url_for('stapf.batch_new')}}">
      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Neuer Auftrag
    </a>
  </div>

  <br />

  <div class="table-responsive">
  <table class='table'>
    <tr>
      <th>Betreff</th>
      <th>Versendet</th>
      <th>Versendet am</th>
      <th>Kommentar</th>
      <th>Aktionen</th>
    </tr>
    <tbody id="batches">
    {% for batch in batches %}
    <tr>
      <td>{{ batch.subject }}</td>
      <td>{% if batch.sent %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{% endif %}</td>
      <td>{% if batch.sent %}{{ batch.sent_at }}{% endif %}</td>
      <td>{{ batch.comment }}</td>
      <td>
        <div class="btn-group" role="group">
         {% if not batch.sent %}
          <a class="btn-default btn" href="{{url_for('stapf.batch_send', batch_id=batch.id)}}">
            <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> Versenden
          </a>
          <a class="btn-default btn" href="{{url_for('stapf.batch', batch_id=batch.id)}}">
            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Bearbeiten
          </a>
          <a class="btn-danger btn" href="{{url_for('stapf.batch_delete', batch_id=batch.id)}}">
            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Löschen
          </a>
         {% else %}
          <a class="btn-default btn" href="{{url_for('stapf.batch', batch_id=batch.id)}}">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span> Details
          </a>
         {% endif %}
        </div>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  </div>
</div>
{% endblock %}
